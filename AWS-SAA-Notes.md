# AWS Solution Architect Associate

  * [IAM](#iam)
  * [S3](#s3)
  * [Compute / EC2 / Lambda](#compute-ec2-lambda)
  * [Route 53](#route-53)
  * [Databases](#databases)
  * [VPC](#vpc)
    - [Steps to provision / create a custom VPC](#steps-to-provision-create-a-custom-vpc)
  * [Application Services](#application-services)
  * [Whitepapers & Well Architected Framework](#whitepapers-and-well-architected-framework)

## IAM
- Users - individual access to the console
- Groups - collection of users
- Roles - assigned to resources to grant access to other resources
- Policies - documents that define resource access
- Root account = god mode
- Sign in url is customisable, (globally unique)
- Always enable MFA
- IAM is universal
- New users = no permissions, get access key and Secret access key, password (can only view this once)

## S3
- object based, KEY-VALUE store (key object name, value data, version id, metadata, sub-recs - ACLs - Torrent)
    - Files, etc.
    - Not suitable for OS installs (use EBS instead)
- 0B - 5TB
- unlimited storage
- stored in buckets - basically a cloud based folder
- S3 names are globally unique, urls are: https://s3-<region>.amazonaws.com/<bucketName>
- interaction is API based, normal http response codes
- Can get faster uploads by enabling multi-part upload
- new objects = read after write consistent
- old objects = eventual consistent
- S3 Standard: SLA 99.9 available, 99.999999999 durable
- S3 Infrequently Accessed: slightly less cost
- S3 One zone IA - lower cost, not replicated across AZs
- Glacier - Expidited, Standard, Bulk. Standard tier takes about 3-5 hours
- versioning
    - pay for each version
    - each new version needs to be made public individually
    - deleting a versioned object will create a following version which is the delete marker
    - can enable MFA delete, extra delete security
- Access Control Lists => regulate access to individual objects
- Bucket Policies => way of regulating access to entire buckets
    - Policies written in JSON
    - Can be used to make entire buckets public
    - Statement
        Sid - Statement Id
        Effect - Allow or Deny
        Principle - Who/what is attempting access
        Action - What actions are being effected (i.e. denied or allowed)
        Resource - What is being accessed (ARN - can be wildcard)
- Default all buckets and objects are private
- Successful upload gets HTTP 200 response
- 3 types: S3, S3-IA and S3-resource
- Can be encrypted - either client or server side (own or managed)
    - In transit
        - SSL/TLS
    - At Rest
        - Server Side
            - S3 Managed Keys - __SSE S3__ (AES256, managed by AWS)
            - AWS KMS - __SSE-KMS__ (envelope key, audit trail when keys used and by who, and can manage own keys)
            - Cutomer Provided Keys - __SSE-C__ - Keys managed by us
        - Client Side
            - Encrypt data on client side before uploading, decrypt client side after downloading
- Cross Region Replication
    - Must be in a different region
    - Cross Region replication requires versioning to be enbabled on both source and destination buckets
    - Existing files will not be automatically replicated, need to be manually copied in via cli
    - New files and changes replicated automatically
    - Deleting an object (object marker) or object version in primary will not be automatically replicated into the replication bucket
- LifeCycle Rules
    - To be used in conjunction with versioning
    - can have rules for current and previous versions
    - can use it to delete permanently as well
    - transition to standard IA class
    - archive
- CloudFront
    - is a Content Delivery Network (CDN)
    - requests for any (not just static) content delivered to Edge Locations with lowest latency
    - __Edge location__ is a location where content will be cached. Different than Region or AZ
    - Origin is where the files will come from - S3, EC2, ELB or Route 53, or non-AWS source
    - Distribution is the collection of edge locations
    - Can actually PUT to edge locations, not just Read Only
    - Files chached for the Time-To-Live value (TTL), but can be invalidated with an account change
    - Should be secured using pre-signed URLs or cookies
    - Can force users to not be able to access content from origin directly
- Can be configured to create acccess logs
- Storage Gateway - connect on-prem DC to AWS Data Store (S3 or Glacier). VM installed in customer DC
    - File Gateway (NFS) - flat files
    - Volume Gateways (iSCSI) - block storage - incremental volume backups
        - Stored Volumes
        - Cached Voumes
    - Tape Gateway (VTL) - Archive data
- Snowball -  Physical disk connected to DC, files uploaded, then sent to AWS to be uploaded on network internally
    - replaced Import Export, different disks sent to AWS, difficult to manage
    - Encrypted
    - Types
        - Snowball - just basic storage
        - Edge - has compute capabilites on it, i.e. can run Lambdas on uploaded data
        - Snowmobile - Truck version of Snowball, Exabyte scale data transfer 100PB per truck
- Transfer Acceleration
    - Upload files to an edge location, makes uploads faster when latency would be otherwise higher
    - Optimised over Amazone backbone technology
    - Cost extra
- Static website hosting
    - Serverless site hosting
    - Endpoint format - <BucketName>.s3-website-<Region>.amazonaws.com
    - Scales automatically
 
## Compute EC2 Lambda
- Elastic Compute Cloud
    - VMs in the cloud, resizable capacity
- Pricing
    - On demand - pay per fixed rate, no commitment, good for spiky that can't be interupted
    - Reserved - capcity reservation - 1 or 3 years, discounted, good for predictable workloads
    - Spot - bid for instance capacity - needs flexible start/end times
    - Dedicated hosts - physical dedicated servers, where multi tenancy can be done. can be good for per server software, i.e. VMWare, or regulatory needs
- Types
    - F1, I3, G3 H1, T2, D2, R4, M5, C5, P3, X1 (__FIGHT DR MCPX__)
- Termination protection is turned __off__ by defailt
- For EBS backed volumes, ebs volume deleted when instance terminated
- __Can't encrypt root volume of default AMIs__, but can create own AMI and encrypt that.
- Any other volumes can be encrypted
- As you increase CPU / ram you also increase network throughput/bandwith
- AMI - Amazon Machine Image
- An AMI is required for Auto scaling
- AMI needs to determine the root device for boot disk EBS or Instance store volume
- Virtulisation type ie what hypervisor - xen ( highly customised ) or nitro
- HVM or PV ( Hardware Virtulisation ) ( Paravirtualisation )
- HVM provides extentions to be "closer" to the hardware, ie access GPU
- AWS runs all Intel CPU's
- CPU Types are Letter then Number Ie m - General and 5 which is the 5th generation
- Instances can be Instance Store or EBS backed
    - Local disks are called "Instance store volumes" Ephemeral Storage
        - These cannot be stopped. Host failures mean data loss
    - EBS can be stopped. Host failures don't result in data loss
    - Can reboot both
    - Root volumes are deleted on termination (although can persist the EBS volumes by choice)
- Dedicated Tenancy a VPC and EC2 where you are the only customer on that hardware
- Spot instance, heavy discounts for unused compute but can be terminated at any time
- EBS - Persistant storage volumes, can have a file system. Placed in a specific AZ, replicated within the AZ.
    - Root device volume is the one attached to EC2 instances, where OS is installed (should stop first if taking a snapshot)
    - Types:
        - GP2 - General purpose, 3 IOPS per GB up to 10,000 IPOS, burst up to 3000 IOPS
        - Provisioned IOPS SSD - if you need more than 10K IOPS
        - Throughput optimised HDD, (frequently accessed data) big data, data warehouses, log processing, can't be a boot volume
        - Cold HDD - low cost, IA -  probs a file server
        - Magnetic - lowest cost, legacy, IA data
    - EBS Volume will __always__ be in the same AZ as the EC2 instance
    - Snapshots stored in S3, but can't be viewed directly
    - use 'aws ec2 create-snapshot' command from cli to create a snapshot
    - Snapshots are incremental, first ones can take some time to take
    - Can take snapshot of in-use EBS volume, but this will exclude any data that's cached by OS or apps. To ensure application consistent snapshots: 
        - unmount the volume from within the instance
        - issue the snapshot command
        - remount the volume (can remount while the snapshot status = pending)
    - Can change EBS volumes size on  the fly (with volume running)
    - To __move EC2 volume to another AZ or Region__, need to take a snapshot, or an image and can then copy it to the new AZ or Region
    - Same for AMIs
    - Snaps of encrypted volumes are automatically encrypted, same goes for restoring from snaps
    - Can share unencrypted volumes
    - You can add multiple volumes to an EC2 instance and then create your own RAID 5/RAID 10/RAID 0 configurations using those volumes
    - Snapshot of RAID Array - take application consistent snapshot: Stop app, flush transactions, unmount raid array (shotdown ec2), take snapshot
- Security Groups 
    - Changes to SGs are applied immediately
    - Can have multiple SGs per instance
    - all inbound traffic blocked by default - all outbound allowed
    - SGs are stateful, allowed inbound traffic is allowed back out, without needing to specify the outbound rule (ACLs work Stateless)
    - Can't block specific traffic with SGs, only allow
- Load Balancers
    - You can set the IP address type of your Internet-facing load balancer when you create it or after it is active. Note that internal load balancers must use IPv4 addresses.
        - The following are the load balancer IP address types:
            - ipv4, The load balancer supports only IPv4 addresses (for example, 192.0.2.1)
            - dualstack The load balancer supports both IPv4 and IPv6 addresses (for example, 2001:0db8:85a3:0:0:8a2e:0370:7334).
    - Load balancers in EC2-Classic support both IPv4 and IPv6 addresses
    - Application Load balancers
        - http / https traffic 
        - layer 7 (application) balanced, i.e. looks at web app
    - Network Load balancers
        - layer 4 connection
        - useful when extreme performance is required
    - Classic load balancers (old terminology Elastic LB)
        - Layer 4 connection, but can look at particular layer 7 stuff like X-Forwarded & stick sessions
        - Relies purely on TCP connections
        - Responds with a 504 if there's an issue behind the LB
    - X-Forwarded-For header - passes public IP onto application
- CloudWatch
    - Can look at the performance of underlying resources
    - Dashboards / Alarms / Events / Logs
    - Monitoring
        - Standard = 5min
        - Detailed = 1min
- CloudTrail
    - Auditing, what has been changed / created / deleted. Record of API calls
- Command Line
    - Can configure with "aws configure" with key/secret keys, This should be avoided, uses Roles instead
    - Role gives access only to the resources that have that role assigned, no need to store on instances
    - Can attach IAM roles to running EC2 instances
    - Used to require "--region" for some cli commands accessing resources cross-region, not needed anymore
- Bash scripting
    - Useful for stuff like automating setting up of a web-server, etc
    - Runs everytime an EC2 instance is started
    - Needs to be started with shebang - #!/bin/bash (#!{path/to/interpreter})
    - Added in "Advances Details" under launch configuration section
- EC2 Metadata
    - get with "curl http://169.254.169.254/latest/meta-data"
    - gives stuff like ip or ami-id ("curl http://169.254.169.254/latest/meta-data/public-ipv4", "curl http://169.254.169.254/latest/meta-data/ami-id")
    - "curl http://169.254.169.254/latest/user-data" gives the bootstrap script
- Lauch configurations and AutoScaling
    - LC: select AMI (can be custom or AWS ones), add bootstrap script
    - ASG: 
        -   select group size (how many instances to start with), 
        - select subnet(s) - use all for best redundancy, 
        - set load balancing, and what the healthcheck type is (is it ec2 or elb) and the grace-time (time after the instance starts before checking, default is 5 minutes), 
        - set the scaling policy (when to increase or decrease size of group) (or say to leave at initial size)
        - set the notification settings
        - tags
    -  Automatically provisions instances evenly accross selected availability zones
    - Recreates new instances when instances aren't available (i.e. healthcheck can't be found) anymore
- Placement groups
    - Clustered PG, Spread PG
    - Typlically exam refers to Clustered PG
        - placed within __single AZ__
        - low latency
        - allows for high network throughput
        - only things with high specs generally can be provisioned in PGs
    - Spread PG
        - ensures all instances are provisioned on different AZs
- EFS
    - on-demand, scalable storage
    - scales to petabytes
    - handles 1000s of connections
    - block-based storage
    - Read after write consistency
    - is essentially a file server
    - can do user and directory level permissions
    - use case is having muliple ec2 instances using the one central locations connecting to it
- Lambda
    - Serverless technology
    - Just upload code, all underlying infrastructure and runtime managed by AWS
    - completely scalable outwards automatically (but not up!)
    - runs based on a trigger, these are the triggers available:
        - API Gateway
        - AWS IoT
        - Alexa Skills / Smart Home
        - CloudFront
        - Cloudwatch events/logs
        - CodeCommit
        - Cognito Sync Trigger
        - DynamoDB
        - Kinesis S3
        - SNS
    - can run up to 15 minutes
    - Runs many types of languages
        - C# .NET Core
        - Go
        - Java
        - Node.js
        - Python
        - (Can use your own custom runtime)
    - A million invocations per month free, then some fee (~$0.20 per million calls)
    - No servers (no adminstration needed)
    - Other services services
        - dynamoDB, S3, Cognito, etc.
    - Architecture can get complicated - Use XRAY to debug
    - Has a IAM Role associated with it. The basic execution role is now called "Simple Microservice permissions"
        - This will need changing depending on what services Lambda needs to connect to
    - Serverless static site uses S3 for static content hosting, lambda for compute, etc.
    - To enable s3 to connect to api gateway on another domain, need to enable CORS for the methods that need the resource(s)
    
## Route 53
- DNS General info
    - DNS Converts human readable names to an IP address
    - IPv4 - 32bit address, IPv6 128bit address
    - Domains - top level .com, .gov (managed by IANA) - 2nd level .com.au, .co.uk
    - Regitrars: place to ensure no domain duplications. GoDaddy, Route53, etc.
    - NS Records
    - A Record - Used to translate a domain name to an address
    - CName - resolve one domain to another
    - TTL - DNS records have a TTL
    - Alias records (Route 53 only) - pooint to an reource record set
        - CNames can't be used for naked domain names, Aliases can
        - SHould choose Alias ove CNAME
    - __ELBs don't have an IPv4 address, only an DNS Name__
    - DNS Types: SOA Records, NS Records, A Records, CNAMES, MX Records, PTR Records
- Routing Policies available:
    - Simple
        - Default - no complex smarts, just send requests to a endpoint
    - Weighted
        - splits traffic across multiple endpoints (e.g. 20% US-East-1, 80% US-West-1
    - Latency
        - Routes traffic based on end-user netowrk latency 
    - Failover
        - For Active/Passive setup, monitors health of site. sends traffic to passive site if active fails (is down).
    -

## Databases
- RDS 
    - Sql server, oracle, mysql, postgresql, aurora, mariadb
    - Multi AZ - DR
    - Read Replica - Performance
    - OLTP
- Non relational
    - DynamoDB
- Data Warehouses
    - Redshift (OLAP)
- Elasticache
    - in memory cache - caches commonly accessed web requests from a cache
    - use to reduce load on DB
    - MemCached
    - Redis

## VPC
- No Transative peering - can't connect from one VPC to another via a middle one, need direct peering between each VPC that need to connect

# Steps to provision create a custom VPC
- Select region
- Go to ‘VPC’ Dashboard
- Click ‘Create VPC’
    - Give it a name
    - Pick the cidr block (use cidr.xyz to check values) - largest is 10.0.0.0/16
    - Use "Amazon provided IPv6 CIDR block and Default Tenancy
    - Once created, along with the VPC, this creates the following by default:
        - Route Table
        - NACL
        - Security Group
- Create subnet(s), we want 1 private and 1 public
    - CIDR block is sub of CIDR for VPC - e.g. 10.0.1.0/24 and 10.0.2.0/24
    - Give name that references AZ for readability
    - Make one subnet public (i.e. 10.0.1.0)
        - Select subnet - Actions - “Modify auto-assign IP settings”
        - Check “Enable auto-assign public IPv4 address” - Save
- Add an internet gateway - IGW
    - Click on “internet gateways”
    - Click “Create Internet Gateway”
    - Provide name
    - Click “Create”
    - Select IGW - click Actions - click Attach to VPC
    - Select the VPC, click attach
- Configure main Route
    - Click on “Route Tables”
    - Click on “Create Route Table”
    - Give name (publicRoute, etc.) and select VPC
    - Create Route out to internet
        - Click “Edit Routes”
        - Click “Add Route” - 0.0.0.0/0 - select the internet gateway
        - Click “Add Route” - ::/0 - select the internet gateway
        - Click “Save Routes”
    - Click on subnet associations tab - Edit subnet associations
    - Add public subnet (10.0.1.0) to route table
- Create EC2 instance in public subnet
    - Click on Ec2 Service
    - Launch instance
    - Select ami
    - Select VPC
    - Select Public subnet
    - Give name 
    - Add WebDMZ security group, SSH and HTTP access
- Create EC2 instance in private subnet
    - Click on Ec2 Service
    - Launch instance
    - Select ami
    - Select VPC
    - Select private subnet
    - Give name 
    - Add default security group
- Create private security group
    - “Security Groups” under EC2
    - Click “Create Security Group”
    - Add the following Inbound
        - All ICMP - Source 10.0.1.0/24
        - Http  - Source 10.0.1.0/24
        - Https - Source 10.0.1.0/24
        - MySQL/Aurora  - Source 10.0.1.0/24 (or whatever service you need to access)
        - SSH - Source 10.0.1.0/24
    - Go to private EC2 instance - change the security group to the new Private SG (Actions, Networking, Change Security Groups)
- Add NAT instance (should use NAT Gateway instead)
    - Launch EC2 instance, Community AMIs, Search “nat”, select 1st instance in list, use t2.micro
    - Launch in public subnet in custom VPC
    - Add to WebDMZ SG
    - Select “Make General Purpose (SSD) the boot volume for this instance.”
    - Launch
    - Disable Source/Destination checks
        - Select instance, actions, networking, change Source/Dest. Check
        - Select “Yes, Disable”
    - Create Route from private EC2 instance to NAT Instance
        - Click on VPC Dashboard, Route Tables, Select the main route
        - Go to Routes tab, edit routes, add route
        - Add internet traffic 0.0.0.0/0 targeting the NAT instance (Instance, select the NAT instance)
        - Private instance can now access the internet
    - Terminate the instance
        - Private instance can NOT access the internet
    - Remove the route on the main route table (should now be a blackhole status)
- Add NAT Gateway
    - VPC Dashboard - NAT Gateways - Create NAT Gateway
    - Select public subnet
    - Create new Elastic IP address
    - Click “Create a NAT Gateway”
    - Click “Edit Route Table”
    - Select Main route table - Routes tab - Edit routes - Add route - 0.0.0.0/0, target NAT Gateway -> select the NAT Gateway - Save, Close
        - Once NAT GW available, Private instance can access the internet
- Configure NACLs (evaluated before SGs)
    - VPC Dashboard - Network ACLs
    - Create network ACL - give name and assign to VPC
    - Edit subnet associations, assign to public subnet - web content not accessible
    - Select the new NACL, edit inbound rules, add rules for port 80, 443, 22 on all sources (0.0.0.0/0)
    - Select the new NACL, edit outbound rules, add rules for port 80, 443 and 1024 - 65535 (ephemeral ports) on all sources (0.0.0.0/0)

## Application Services

## Whitepapers and Well Architected Framework


 
